<div class="card">
  <% if @artist_file.saved_image.attached? %>
    <div class="card-img-top">
        <%= image_tag @artist_file.saved_image, class: 'card-img-top', alt: 'Artwork Image' %>
    </div>
  <% else %>
    <div class="card-img-top">
        <%= image_tag @artist_file.image_url, class: 'card-img-top', alt: 'Artwork Image' %>
    </div>
    <a href="<%= @artist_file.image_url %>" download="saved_image.png" class="btn download-btn">Download</a><br />
  <% end %>

  <%= button_to 'New AI Photo', artist_artist_file_path(@artist, @artist_file), method: :patch, params: { fetch_new_image: true }, class: 'btn new-ai-photo-btn' %>

  <h3>Upload Image</h3>
  <%= form_with(model: [@artist, @artist_file], local: true, data: { turbo: false }) do |form| %>
      <%= form.file_field :saved_image %>
      <%= form.submit 'Upload Image' %>
  <% end %>
  
  <div class="card-body">
    <div><strong>Created:</strong> <%= @artist_file.created_at.strftime("%B %d, %Y") %></div>
    <br />
    <div><strong>Style:</strong> <%= @artist_file.style %></div>
    <div><strong>Goals:</strong> <%= @artist_file.goals %></div>
    <br />
    <div>
    <strong>Action Steps:</strong>
    <p><%= @markdown&.render(@artist_file.action_steps)&.html_safe %></p>
    </div>
    <br />
    <div>
    <% if @artist_file.resources.present? %>
        <div>
        <% parsed_resources = JSON.parse(@artist_file.resources) %>
        <strong>Resources:</strong><% parsed_resources.each do |resource| %>
            <p><%= @markdown&.render(resource)&.html_safe %></p>
        <% end %>
        </div>
    <% end %>
    </div>
    <%= button_to "Delete", artist_artist_file_path(@artist, @artist_file), method: :delete, data: { turbo: false, confirm: 'Are you sure?' }, class: 'btn btn-primary' %>
    <br />
    <%= link_to 'Back', artist_path(@artist), class: 'btn btn-primary mt-3' %>
    <br />
  </div>
</div>
