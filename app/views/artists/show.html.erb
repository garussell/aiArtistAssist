<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Artist AI Assist</title>
        <style>
            body {
                font-family: Arial, Helvetica, sans-serif;
            }
        </style>
    </head>
    <body>
        <div class="artist-info">
            <h1>You Are <%= @artist.name %></h1>
            <div><strong>Style:</strong> <%= @artist.style %></div>
            <div><strong>Bio:</strong> <%= @artist.bio %></div>
            <br />
            <div><%= link_to "Edit Info", edit_artist_path(@artist), class: 'edit-button' %></div>
            <br />
            <div>
                <%= button_to "Delete Profile", artist_path(@artist), method: :delete, data: { turbo: false, confirm: 'Are you sure?' }, class: 'delete-button' %>
            </div>
        </div>

        <div class="ai-prompt-section">
            <h2>AI Prompt</h2>
            <%= form_for [@artist, ArtistFile.new] do |f| %>
            <div>
                <h3>What can you tell me about your next creative project?</h3>

                <%= f.label :goals %> <%= f.text_area :goals %>
            </div>
            <br />
            <div>
                <%= f.submit "Get Prompt" %>
            </div>
            <% end %>
        </div>
        <div class="collection-of-prompts">
            <% if @artist_files.count > 0 %>
            <ul>
                <h2>Collection of Ideas</h2>
                <br />
                <% @artist_files.reverse_each do |artist_file| %>
                    <% if artist_file.saved_image.attached? %>
                        <div class="image-container"><%= image_tag artist_file.saved_image %></div>
                    <% else %>
                        <div class="image-container"><%= image_tag artist_file.image_url %></div>
                        <%= link_to 'Download Temp Image', artist_file.image_url, download: 'temp_image.png', class: 'btn btn-primary' %>
                    <% end %>

                    <h3>Upload Image</h3>
                    <%= form_with(model: [@artist, artist_file], local: true) do |form| %>
                        <%= form.file_field :saved_image %>
                        <%= form.submit 'Upload Image' %>
                    <% end %>
                <br />
                <div><strong>Created:</strong> <%= artist_file.created_at.strftime("%B %d, %Y") %></div>
                <br />
                <div><strong>Goals:</strong> <%= artist_file.goals %></div>
                <br />
                <div>
                    <strong>Action Steps:</strong>
                    <p><%= @markdown.render(artist_file.action_steps).html_safe %></p>
                </div>
                <br />
                <div>
                    <% if artist_file.resources.present? %>
                    <div>
                        <% parsed_resources = JSON.parse(artist_file.resources) %>
                        <strong>Resources:</strong><% parsed_resources.each do |resource| %>
                            <p><%= @markdown.render(resource).html_safe %></p>
                        <% end %>
                    </div>
                    <% end %>
                </div>
                <br />
                <div>
                    <%= button_to "Delete Prompt", artist_artist_file_path(@artist, artist_file), method: :delete, data: { turbo: false, confirm: 'Are you sure?' }, class: 'delete-button' %>
                </div>
                <br />
                <br />
                <% end %>
            </ul>

            <% end %>
        </div>
    </body>
</html>